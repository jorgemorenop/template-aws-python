# AWS Python Lambda Template


## Quickstart

This is a project generated with the cookiecutter, here it is a quick explanation of the things you will find in this repository.
Feel free to delete from this section onwards once you are familiarized with the repo.

### Python code

In most cases, when we create a new process we have to implement either Lambda functions, or ECS tasks. For organisation,
we have decided that each of these (a Lambda function and an ECS task) will be saved in the project as a separated folder.

All functions are located on the `functions/` folder. They usually contain an `app.py` script 
that will execute the main function `__main__.main` regardless of whether the function corresponds to 
a Lambda function or an ECS function. 


### Lambda vs ECS tasks

The project and its structure is prepared to work for both cases: our function 
being a Lambda or an ECS task. Only changes to make if you want to go from one
to another are:

1. In this repository, modify the `template.yaml` file replacing the Serverless Function
resource with all the resources needed for ECS (ECS task, Task role, Execution role, schedule, etc). 
You can create another repository from the same template and choose to create and ECS task, to check
what resources are needed.

2. If your CI/CD pipeline, you will need to reflect this change.


### Deployment


#### Config files

The `config` folder is the location where all the parameters files for the creation of the stack with Cloudformation are 
going to be located. This includes a folder for each environment we deploy to (`dev`, `stage` and `prod`), and in each one,
a file for each region we are going to deploy to (usually only `eu-west-1`).

### template.yaml

This is one important file, since it describes the Cloudformation stack that we are going to use. We usually use AWS::Serverless, 
and we define each function's path with the local path to the functions folder, since this will be resolved in the pipeline.

### Deploy with a CI/CD pipeline

Either if you are using Jenkins, Codepipeline, or deploying this project manually, you would need to first package the deployment
with Cloudformation [package](https://docs.aws.amazon.com/cli/latest/reference/cloudformation/package.html) command.


### Tests

Before running the code remember that you will need to install the dependencies of the project:

```
pip install -r requirements.txt
```

#### Run function locally

In the `local/` folder, you will find additional scripts that will let you to run your code locally.
You will find:
- A `.env` file that contains all the environmental variables that will be used in the local execution.
- A `run_my_function.py` file that will allow as to run the function with simulated events
(located in the `events` folder on the root folder).
- A `common_local` folder which contain useful files for the local executions.

#### Run unit tests

You can create new unit tests in the `tests/unit/` folder (please replace the autogenerated ones).

To run unit tests, please ensure you have followed previous steps to install all needed libraries
from requirements.txt. Then, you will be able to use `pytest` to run your tests:

```bash
pytest tests/unit/
```
 each function's path with the local path to the functions folder, since this will be resolved in the pipeline
 